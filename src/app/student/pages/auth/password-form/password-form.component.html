<!-- Header Section -->
<div class="page-section pb-0">
  <div class="container-fluid page__container d-flex flex-column flex-sm-row align-items-sm-center">
    <div class="flex">
      <h1 class="h2 mb-0">
        {{ mode === 'update' ? 'Update Password' : 'Reset Password' }}
      </h1>
      <p class="text-breadcrumb">Account Management</p>
    </div>
    <p class="d-sm-none"></p>
    <div class="d-flex gap-2 mb-3">
      <button 
        class="btn btn-outline-primary" 
        [class.active]="mode === 'update'"
        (click)="mode = 'update'">
        Update Password
      </button>
      <button 
        class="btn btn-outline-secondary" 
        [class.active]="mode === 'forgot'"
        (click)="mode = 'forgot'">
        Reset Password
      </button>
    </div>
  </div>
</div>

<!-- Content Section -->
<div class="page-section">
  <div class="container-fluid page__container">
    <div class="page-separator">
      <div class="page-separator__text">
        {{ mode === 'update' ? 'Update Password' : 'Reset Password' }}
      </div>
    </div>

    <!-- Change Password Form -->
    @if (mode === 'update') {
      <form [formGroup]="passwordForm" (ngSubmit)="onChangeSubmit()" class="col-sm-5 p-0">
        <div class="form-group">
          <label class="form-label" for="password">Password:</label>
          <input 
            id="password" 
            type="password" 
            class="form-control" 
            formControlName="password"
            placeholder="Type a new password ...">

          @if (password?.touched && password?.hasError('required')) {
            <small class="text-danger">Password is required.</small>
          }
          @if (password?.touched && password?.hasError('minlength')) {
            <small class="text-danger">Password must be at least 6 characters.</small>
          }
        </div>

        <div class="form-group">
          <label class="form-label" for="password2">Confirm Password:</label>
          <input 
            id="password2" 
            type="password" 
            class="form-control" 
            formControlName="confirmPassword"
            placeholder="Confirm your new password ...">

          @if (confirmPassword?.touched && confirmPassword?.hasError('required')) {
            <small class="text-danger">Confirmation is required.</small>
          }
          @if (passwordForm.hasError('passwordMismatch') && confirmPassword?.touched) {
            <small class="text-danger">Passwords do not match.</small>
          }
        </div>

        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="passwordForm.invalid">
          Save password
        </button>
      </form>
    }

    <!-- Reset Password Form -->
    @if (mode === 'forgot') {
      <div class="col-sm-6 p-0">
        @if (emailSent) {
          <div class="alert alert-soft-warning">
            <div class="d-flex flex-wrap">
              <div class="mr-8pt">
                <i class="material-icons">check_circle</i>
              </div>
              <div class="flex" style="min-width: 180px">
                <small class="text-100">
                  An email with password reset instructions has been sent to your email address, if it exists on our system.
                </small>
              </div>
            </div>
          </div>
        }

        <form [formGroup]="resetForm" (ngSubmit)="onResetSubmit()">
          <div class="form-group">
            <label class="form-label">Email:</label>
            <input 
              type="email" 
              class="form-control" 
              placeholder="Your email address ..." 
              formControlName="email">
            
            <small class="form-text text-muted">
              We will email you with info on how to reset your password.
            </small>

            @if (resetForm.get('email')?.touched && resetForm.get('email')?.invalid) {
              <div class="text-danger mt-1">
                @if (resetForm.get('email')?.errors?.['required']) {
                  <div>Email is required.</div>
                }
                @if (resetForm.get('email')?.errors?.['email']) {
                  <div>Enter a valid email address.</div>
                }
              </div>
            }
          </div>
          
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="resetForm.invalid">
            Reset
          </button>
        </form>
      </div>
    }
  </div>
</div>

